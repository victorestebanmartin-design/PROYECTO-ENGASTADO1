<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ  Dashboard - Sistema de Engastado</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=landing3">
  <style>
    .landing-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .stat-item {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
      color: white !important;
      padding: 1.5rem;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3) !important;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: none !important;
    }
    .stat-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4) !important;
    }
    .stat-icon {
      font-size: 2.5rem;
      opacity: 0.9;
      color: white !important;
    }
    .stat-info {
      flex: 1;
    }
    .stat-label {
      font-size: 0.85rem;
      opacity: 0.9;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: white !important;
    }
    .stat-value {
      font-size: 1.8rem;
      font-weight: 700;
      margin-top: 0.25rem;
      color: white !important;
    }
    .loading-stat {
      opacity: 0.7;
      font-size: 1.2rem;
      color: white !important;
    }
  </style>
</head>
<body>
  <div class="container landing-container">
    <header class="header landing-header">
      <div class="landing-logo">
        <div class="logo-icon">ğŸ”§</div>
        <div>
          <h1>Sistema de Engastado AutomÃ¡tico</h1>
          <div class="landing-version">VersiÃ³n 3.0 Pro</div>
        </div>
      </div>
      <p class="landing-subtitle">Panel de control unificado - GestiÃ³n integral de producciÃ³n</p>
    </header>

    <div class="landing-stats" id="dashboard-stats">
      <div class="stat-item">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-info">
          <div class="stat-label">Terminales</div>
          <div class="stat-value loading-stat">â³ Cargando...</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon">ğŸ“</div>
        <div class="stat-info">
          <div class="stat-label">Proyectos</div>
          <div class="stat-value loading-stat">â³ Cargando...</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon">âš™ï¸</div>
        <div class="stat-info">
          <div class="stat-label">MÃ¡quinas</div>
          <div class="stat-value loading-stat">â³ Cargando...</div>
        </div>
      </div>
      <div class="stat-item">
        <div class="stat-icon">ğŸ¯</div>
        <div class="stat-info">
          <div class="stat-label">Estado</div>
          <div class="stat-value">âœ… Operativo</div>
        </div>
      </div>
    </div>

    <div class="card landing-selector">
      <h2 class="landing-title">ğŸš€ MÃ³dulos del Sistema</h2>
      <div class="version-grid">
        <div class="version-card version-v3 recommended">
          <div class="version-badge">OperaciÃ³n</div>
          <div class="version-icon">ğŸš€</div>
          <h3>Engastado V3</h3>
          <p>Sistema principal de engastado con lectura de cÃ³digos de barras, asignaciÃ³n de terminales y flujo guiado paso a paso.</p>
          <div class="version-features">
            <span class="feature-tag">Scanner integrado</span>
            <span class="feature-tag">Flujo guiado</span>
            <span class="feature-tag">Agrupado inteligente</span>
          </div>
          <a href="{{ url_for('main.index_v3') }}" class="btn-primary btn-version btn-version-v3">ğŸ”§ Iniciar Engastado</a>
        </div>
        <div class="version-card version-admin">
          <div class="version-icon">âš™ï¸</div>
          <h3>AdministraciÃ³n</h3>
          <p>GestiÃ³n de archivos Excel, cÃ³digos de barras, configuraciÃ³n de terminales, impresora y actualizaciones del sistema.</p>
          <div class="version-features">
            <span class="feature-tag">Archivos Excel</span>
            <span class="feature-tag">Config. terminales</span>
            <span class="feature-tag">Sistema</span>
          </div>
          <a href="{{ url_for('main.admin') }}" class="btn-primary btn-version btn-version-admin">âš™ï¸ Administrar</a>
        </div>
        <div class="version-card version-puestos">
          <div class="version-icon">ğŸ¢</div>
          <h3>Puestos y MÃ¡quinas</h3>
          <p>Define la estructura organizacional: crea puestos de trabajo, registra mÃ¡quinas y asigna terminales a cada equipo.</p>
          <div class="version-features">
            <span class="feature-tag">Puestos</span>
            <span class="feature-tag">MÃ¡quinas</span>
            <span class="feature-tag">Asignaciones</span>
          </div>
          <a href="{{ url_for('main.gestion_puestos') }}" class="btn-primary btn-version btn-version-puestos">ğŸ¢ Configurar</a>
        </div>
        <div class="version-card version-proyectos">
          <div class="version-icon">ğŸš›</div>
          <h3>GestiÃ³n de Bonos</h3>
          <p>Crea bonos de producciÃ³n, asigna carros, gestiona proyectos activos y genera reportes detallados de progreso.</p>
          <div class="version-features">
            <span class="feature-tag">Bonos</span>
            <span class="feature-tag">Carros</span>
            <span class="feature-tag">Reportes</span>
          </div>
          <a href="{{ url_for('main.gestion_proyectos') }}" class="btn-primary btn-version btn-version-proyectos">ğŸš› Gestionar Bonos</a>
        </div>
        <div class="version-card version-visualizacion">
          <div class="version-icon">ğŸ“Š</div>
          <h3>VisualizaciÃ³n</h3>
          <p>Dashboard en tiempo real con progreso de bonos, estados de carros y mÃ©tricas de producciÃ³n. Ideal para pantallas externas.</p>
          <div class="version-features">
            <span class="feature-tag">Tiempo real</span>
            <span class="feature-tag">Multi-pantalla</span>
            <span class="feature-tag">MÃ©tricas</span>
          </div>
          <a href="{{ url_for('main.visualizacion') }}" class="btn-primary btn-version btn-version-visualizacion">ğŸ“Š Monitorear</a>
        </div>
        <div class="version-card version-ordenes">
          <div class="version-icon">ğŸ“‹</div>
          <h3>Ã“rdenes de ProducciÃ³n</h3>
          <p>Registra, consulta y organiza Ã³rdenes de producciÃ³n. Control de stock de cortes de cable y planificaciÃ³n de bonos.</p>
          <div class="version-features">
            <span class="feature-tag">Ã“rdenes</span>
            <span class="feature-tag">Stock</span>
            <span class="feature-tag">PlanificaciÃ³n</span>
          </div>
          <a href="{{ url_for('main.registro_ordenes') }}" class="btn-primary btn-version btn-version-ordenes">ğŸ“‹ Ã“rdenes</a>
        </div>
        <div class="version-card version-etiquetas">
          <div class="version-icon">ğŸ·ï¸</div>
          <h3>Etiquetas</h3>
          <p>Genera e imprime etiquetas para elementos de cortes. Formato A4 con 65 etiquetas troqueladas de 5x13mm.</p>
          <div class="version-features">
            <span class="feature-tag">Formato A4</span>
            <span class="feature-tag">65 uds</span>
            <span class="feature-tag">ImpresiÃ³n</span>
          </div>
          <a href="{{ url_for('main.etiquetas') }}" class="btn-primary btn-version btn-version-etiquetas">ğŸ·ï¸ Etiquetar</a>
        </div>
      </div>
    </div>

    <div class="card landing-summary">
      <h2 class="landing-summary-title">ğŸ“Œ GuÃ­a RÃ¡pida</h2>
      <ul class="landing-list">
        <li><strong>Engastado V3:</strong> MÃ³dulo principal para operaciÃ³n de engastado con scanner y flujo guiado.</li>
        <li><strong>AdministraciÃ³n:</strong> GestiÃ³n de archivos Excel, terminales y configuraciÃ³n del sistema.</li>
        <li><strong>Puestos y MÃ¡quinas:</strong> Estructura organizacional, asignaciÃ³n de terminales por equipo.</li>
        <li><strong>Bonos:</strong> CreaciÃ³n de bonos de producciÃ³n, asignaciÃ³n de carros y reportes.</li>
        <li><strong>VisualizaciÃ³n:</strong> Dashboard en tiempo real para monitoreo de progreso.</li>
        <li><strong>Ã“rdenes:</strong> Control de stock y planificaciÃ³n de Ã³rdenes de producciÃ³n.</li>
        <li><strong>Etiquetas:</strong> GeneraciÃ³n e impresiÃ³n de etiquetas identificativas.</li>
      </ul>
      <p class="landing-footnote">ğŸ’¡ Accede al dashboard desde cualquier mÃ³dulo usando el enlace <strong>ğŸ  Inicio</strong> o visitando <code>/</code></p>
    </div>
  </div>
  
  <script>
    // Cargar estadÃ­sticas dinÃ¡micas del dashboard
    async function cargarEstadisticas() {
      try {
        // Cargar terminales
        const resTerminales = await fetch('/api/listar_terminales');
        const dataTerminales = await resTerminales.json();
        document.querySelector('#dashboard-stats .stat-value').textContent = 
          dataTerminales.success ? `${dataTerminales.total_terminales} activos` : '0 activos';
        
        // Cargar proyectos
        const resCortes = await fetch('/api/list_cortes');
        const dataCortes = await resCortes.json();
        const numProyectos = dataCortes.cortes ? dataCortes.cortes.length : 0;
        document.querySelectorAll('#dashboard-stats .stat-value')[1].textContent = 
          `${numProyectos} cargados`;
        
        // Cargar mÃ¡quinas
        const resMaquinas = await fetch('/api/maquinas');
        const dataMaquinas = await resMaquinas.json();
        const numMaquinas = dataMaquinas.maquinas ? dataMaquinas.maquinas.length : 0;
        document.querySelectorAll('#dashboard-stats .stat-value')[2].textContent = 
          `${numMaquinas} configuradas`;
      } catch (error) {
        console.error('Error al cargar estadÃ­sticas:', error);
        document.querySelectorAll('.loading-stat').forEach(stat => {
          stat.textContent = 'N/A';
          stat.classList.remove('loading-stat');
        });
      }
    }
    
    // Cargar al iniciar pÃ¡gina
    cargarEstadisticas();
  </script>
</body>
</html>