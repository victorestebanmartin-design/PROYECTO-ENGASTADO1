<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdministraciÃ³n - Sistema de Engastado</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=13">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>âš™ï¸ AdministraciÃ³n del Sistema</h1>
            <a href="{{ url_for('main.home') }}" class="btn-admin">ğŸ”™ Volver al Inicio</a>
        </header>

        <!-- SecciÃ³n: Subir Archivo Excel -->
        <div class="card">
            <h2>ğŸ“¤ Subir Archivo Excel</h2>
            <p class="instruccion">Sube un nuevo archivo Excel con datos de cableado</p>
            
            <form id="upload-form" enctype="multipart/form-data">
                <div class="input-group">
                    <label for="file-upload">Seleccionar Archivo (.xlsx, .xls):</label>
                    <input type="file" id="file-upload" name="file" accept=".xlsx,.xls" required>
                </div>
                
                <button type="submit" class="btn-primary">ğŸ“¤ Subir Archivo</button>
            </form>
            
            <div id="upload-mensaje" class="mensaje hidden"></div>
        </div>

        <!-- SecciÃ³n: Asociar CÃ³digo de Barras con Archivo -->
        <div class="card">
            <h2>ğŸ”— Asociar CÃ³digo de Barras</h2>
            <p class="instruccion">Vincula un cÃ³digo de barras con un archivo Excel subido</p>
            
            <form id="asociar-form">
                <div class="input-group">
                    <label for="codigo-barras">CÃ³digo de Barras:</label>
                    <input type="text" id="codigo-barras" placeholder="Ej: CORADIA_IT_001" required>
                </div>

                <div class="input-group">
                    <label for="select-archivo">Archivo Excel:</label>
                    <select id="select-archivo" required>
                        <option value="">-- Seleccionar archivo --</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="descripcion">DescripciÃ³n:</label>
                    <input type="text" id="descripcion" placeholder="Ej: Listado Cableado Coradia Italia" required>
                </div>

                <div class="input-group">
                    <label for="proyecto">Proyecto (opcional):</label>
                    <input type="text" id="proyecto" placeholder="Ej: Coradia Italia">
                </div>

                <button type="submit" class="btn-primary">âœ… Asociar</button>
            </form>
            
            <div id="asociar-mensaje" class="mensaje hidden"></div>
        </div>

        <!-- SecciÃ³n: Cortes Registrados -->
        <div class="card">
            <h2>ğŸ“‹ Cortes Registrados</h2>
            <p class="instruccion">Lista de cÃ³digos de barras y archivos asociados</p>
            
            <button onclick="cargarCortes()" class="btn-secondary">ğŸ”„ Actualizar Lista</button>
            
            <div id="lista-cortes" class="tabla-container">
                <p class="text-muted">Cargando...</p>
            </div>
        </div>

        <!-- SecciÃ³n: Archivos Disponibles -->
        <div class="card">
            <h2>ğŸ“ Archivos Excel Disponibles</h2>
            <p class="instruccion">Archivos Excel subidos al sistema</p>
            
            <button onclick="cargarArchivos()" class="btn-secondary">ğŸ”„ Actualizar Lista</button>
            
            <div id="lista-archivos" class="tabla-container">
                <p class="text-muted">Cargando...</p>
            </div>
        </div>

        <!-- SecciÃ³n: GestiÃ³n Organizacional -->
        <div class="card">
            <h2>ğŸ¢ GestiÃ³n Organizacional</h2>
            <p class="instruccion">Administra la estructura de tu planta de producciÃ³n</p>
            
            <div class="gestion-organizacional">
                <a href="{{ url_for('main.gestion_puestos') }}" class="gestion-link-card">
                    <div class="gestion-icon">ğŸ­</div>
                    <div class="gestion-content">
                        <h3>Puestos y MÃ¡quinas</h3>
                        <p>Gestiona puestos de trabajo, mÃ¡quinas de producciÃ³n y asignaciÃ³n de terminales</p>
                        <div class="gestion-features">
                            <span>â€¢ Crear y editar puestos</span>
                            <span>â€¢ Gestionar mÃ¡quinas</span>
                            <span>â€¢ Asignar terminales</span>
                        </div>
                    </div>
                    <div class="gestion-arrow">â†’</div>
                </a>
            </div>
        </div>

        <!-- SecciÃ³n: GestiÃ³n de Terminales (Original) -->
        <div class="card">
            <h2>ğŸ”Œ GestiÃ³n de Terminales</h2>
            <p class="instruccion">Activa o desactiva terminales para el sistema de engastado</p>
            
            <button onclick="cargarTerminales()" class="btn-secondary">ğŸ”„ Cargar Terminales</button>
            
            <div id="lista-terminales" class="terminales-admin-container">
                <p class="text-muted">Haz clic en "Cargar Terminales" para ver la lista</p>
            </div>
        </div>

        <!-- SecciÃ³n: Control de Impresora Zebra -->
        <div class="card">
            <h2>ğŸ–¨ï¸ Control de Impresora Zebra GK420T</h2>
            <p class="instruccion">Monitoreo y control de la impresora de etiquetas</p>
            
            <div class="printer-controls">
                <button onclick="verificarEstadoImpresora()" class="btn-secondary">
                    ğŸ” Verificar Estado
                </button>
                
                <button onclick="imprimirPrueba()" class="btn-primary" style="margin-left: 10px;">
                    ğŸ§ª Imprimir Prueba
                </button>
                
                <button onclick="listarEtiquetasSimuladas()" class="btn-secondary" style="margin-left: 10px;">
                    ğŸ“‹ Ver Etiquetas Simuladas
                </button>
            </div>
            
            <div id="printer-status" class="printer-status-container" style="margin-top: 20px;">
                <p class="text-muted">Haz clic en "Verificar Estado" para ver informaciÃ³n de la impresora</p>
            </div>
            
            <div id="printer-simulated" class="printer-simulated-container" style="margin-top: 20px; display: none;">
                <h3>Etiquetas Simuladas</h3>
                <div id="simulated-list"></div>
                <button onclick="limpiarEtiquetasSimuladas()" class="btn-danger" style="margin-top: 10px;">
                    ğŸ—‘ï¸ Limpiar Todas
                </button>
            </div>
            
            <div id="printer-pending" class="printer-pending-container" style="margin-top: 20px; display: none;">
                <h3>Etiquetas Pendientes</h3>
                <div id="pending-list"></div>
                <button onclick="reintentarPendientes()" class="btn-primary" style="margin-top: 10px;">
                    ğŸ”„ Reintentar Todas
                </button>
            </div>
        </div>

        <!-- SecciÃ³n: ActualizaciÃ³n del Sistema -->
        <div class="card">
            <h2>ğŸ”„ ActualizaciÃ³n del Sistema</h2>
            <p class="instruccion">Comprueba si hay actualizaciones disponibles en GitHub y actualiza automÃ¡ticamente</p>
            
            <div id="update-status" class="mensaje hidden"></div>
            
            <button onclick="comprobarActualizaciones()" class="btn-secondary">
                ğŸ” Comprobar Actualizaciones
            </button>
            
            <button onclick="actualizarSistema()" class="btn-primary" style="margin-left: 10px;">
                â¬‡ï¸ Actualizar Ahora
            </button>
        </div>

        <!-- SecciÃ³n: PELIGRO - Resetear Sistema -->
        <div class="card">
            <h2>âš ï¸ ZONA DE PELIGRO</h2>
            <p class="instruccion"><strong>Esta acciÃ³n eliminarÃ¡ TODOS los archivos Excel y TODOS los cÃ³digos de barras registrados. No se puede deshacer.</strong></p>
            
            <button onclick="resetearSistema()" class="btn-danger">
                ğŸ—‘ï¸ RESETEAR TODO EL SISTEMA
            </button>
        </div>
    </div>

    <!-- Modales -->
    <div id="modal-puesto" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Puesto</h3>
                <span class="modal-close" onclick="cerrarModal('modal-puesto')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="puesto-nombre">Nombre del Puesto:</label>
                    <input type="text" id="puesto-nombre" placeholder="Ej: Puesto A - LÃ­nea 1">
                </div>
                <div class="input-group">
                    <label for="puesto-descripcion">DescripciÃ³n:</label>
                    <textarea id="puesto-descripcion" placeholder="DescripciÃ³n del puesto"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModal('modal-puesto')">Cancelar</button>
                <button class="btn-primary" onclick="guardarPuesto()">Guardar</button>
            </div>
        </div>
    </div>

    <div id="modal-maquina" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva MÃ¡quina</h3>
                <span class="modal-close" onclick="cerrarModal('modal-maquina')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="maquina-puesto">Puesto:</label>
                    <select id="maquina-puesto" required>
                        <option value="">-- Seleccionar puesto --</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="maquina-nombre">Nombre de la MÃ¡quina:</label>
                    <input type="text" id="maquina-nombre" placeholder="Ej: MÃ¡quina Engastado 1">
                </div>
                <div class="input-group">
                    <label for="maquina-modelo">Modelo:</label>
                    <input type="text" id="maquina-modelo" placeholder="Ej: KOMAX Alpha 355">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModal('modal-maquina')">Cancelar</button>
                <button class="btn-primary" onclick="guardarMaquina()">Guardar</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>
