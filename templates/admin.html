<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administraci√≥n - Sistema de Engastado</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=13">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>‚öôÔ∏è Administraci√≥n del Sistema</h1>
            <a href="{{ url_for('main.home') }}" class="btn-admin">üîô Volver al Inicio</a>
        </header>

        <!-- Secci√≥n: Subir Archivo Excel -->
        <div class="card">
            <h2>üì§ Subir Archivo Excel</h2>
            <p class="instruccion">Sube un nuevo archivo Excel con datos de cableado</p>
            
            <form id="upload-form" enctype="multipart/form-data">
                <div class="input-group">
                    <label for="file-upload">Seleccionar Archivo (.xlsx, .xls):</label>
                    <input type="file" id="file-upload" name="file" accept=".xlsx,.xls" required>
                </div>
                
                <button type="submit" class="btn-primary">üì§ Subir Archivo</button>
            </form>
            
            <div id="upload-mensaje" class="mensaje hidden"></div>
        </div>

        <!-- Secci√≥n: Asociar C√≥digo de Barras con Archivo -->
        <div class="card">
            <h2>üîó Asociar C√≥digo de Barras</h2>
            <p class="instruccion">Vincula un c√≥digo de barras con un archivo Excel subido</p>
            
            <form id="asociar-form">
                <div class="input-group">
                    <label for="codigo-barras">C√≥digo de Barras:</label>
                    <input type="text" id="codigo-barras" placeholder="Ej: CORADIA_IT_001" required>
                </div>

                <div class="input-group">
                    <label for="select-archivo">Archivo Excel:</label>
                    <select id="select-archivo" required>
                        <option value="">-- Seleccionar archivo --</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="descripcion">Descripci√≥n:</label>
                    <input type="text" id="descripcion" placeholder="Ej: Listado Cableado Coradia Italia" required>
                </div>

                <div class="input-group">
                    <label for="proyecto">Proyecto (opcional):</label>
                    <input type="text" id="proyecto" placeholder="Ej: Coradia Italia">
                </div>

                <button type="submit" class="btn-primary">‚úÖ Asociar</button>
            </form>
            
            <div id="asociar-mensaje" class="mensaje hidden"></div>
        </div>

        <!-- Secci√≥n: Cortes Registrados -->
        <div class="card">
            <h2>üìã Cortes Registrados</h2>
            <p class="instruccion">Lista de c√≥digos de barras y archivos asociados</p>
            
            <button onclick="cargarCortes()" class="btn-secondary">üîÑ Actualizar Lista</button>
            
            <div id="lista-cortes" class="tabla-container">
                <p class="text-muted">Cargando...</p>
            </div>
        </div>

        <!-- Secci√≥n: Archivos Disponibles -->
        <div class="card">
            <h2>üìÅ Archivos Excel Disponibles</h2>
            <p class="instruccion">Archivos Excel subidos al sistema</p>
            
            <button onclick="cargarArchivos()" class="btn-secondary">üîÑ Actualizar Lista</button>
            
            <div id="lista-archivos" class="tabla-container">
                <p class="text-muted">Cargando...</p>
            </div>
        </div>

        <!-- Secci√≥n: Gesti√≥n Organizacional -->
        <div class="card">
            <h2>üè¢ Gesti√≥n Organizacional</h2>
            <p class="instruccion">Administra la estructura de tu planta de producci√≥n</p>
            
            <div class="gestion-organizacional">
                <a href="{{ url_for('main.gestion_puestos') }}" class="gestion-link-card">
                    <div class="gestion-icon">üè≠</div>
                    <div class="gestion-content">
                        <h3>Puestos y M√°quinas</h3>
                        <p>Gestiona puestos de trabajo, m√°quinas de producci√≥n y asignaci√≥n de terminales</p>
                        <div class="gestion-features">
                            <span>‚Ä¢ Crear y editar puestos</span>
                            <span>‚Ä¢ Gestionar m√°quinas</span>
                            <span>‚Ä¢ Asignar terminales</span>
                        </div>
                    </div>
                    <div class="gestion-arrow">‚Üí</div>
                </a>
            </div>
        </div>
            
            <div id="tab-puestos" class="tab-content active">
                <div class="tab-header">
                    <h3>Gesti√≥n de Puestos</h3>
                    <button onclick="mostrarModalPuesto()" class="btn-primary btn-small">‚ûï Nuevo Puesto</button>
                </div>
                <div id="lista-puestos" class="puestos-container">
                    <p class="text-muted">Cargando puestos...</p>
                </div>
            </div>
            
            <div id="tab-maquinas" class="tab-content">
                <div class="tab-header">
                    <h3>Gesti√≥n de M√°quinas</h3>
                    <button onclick="mostrarModalMaquina()" class="btn-primary btn-small">‚ûï Nueva M√°quina</button>
                </div>
                <div id="lista-maquinas" class="maquinas-container">
                    <p class="text-muted">Selecciona un puesto para ver sus m√°quinas</p>
                </div>
            </div>
            
            <div id="tab-asignaciones" class="tab-content">
                <div class="tab-header">
                    <h3>Asignaci√≥n de Terminales</h3>
                    <button onclick="cargarTerminalesParaAsignar()" class="btn-secondary">üîÑ Cargar Terminales</button>
                </div>
                <div id="asignaciones-container">
                    <div class="asignacion-grid">
                        <div id="terminales-disponibles" class="terminales-panel">
                            <h4>Terminales Disponibles</h4>
                            <div class="terminales-list"></div>
                        </div>
                        <div id="maquinas-asignacion" class="maquinas-panel">
                            <h4>M√°quinas</h4>
                            <div class="maquinas-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n: Gesti√≥n de Terminales (Original) -->
        <div class="card">
            <h2>üîå Gesti√≥n de Terminales</h2>
            <p class="instruccion">Activa o desactiva terminales para el sistema de engastado</p>
            
            <button onclick="cargarTerminales()" class="btn-secondary">üîÑ Cargar Terminales</button>
            
            <div id="lista-terminales" class="terminales-admin-container">
                <p class="text-muted">Haz clic en "Cargar Terminales" para ver la lista</p>
            </div>
        </div>

        <!-- Secci√≥n: PELIGRO - Resetear Sistema -->
        <div class="card" style="border: 3px solid #ef4444;">
            <h2 style="color: #ef4444;">‚ö†Ô∏è ZONA DE PELIGRO</h2>
            <p class="instruccion" style="color: #dc2626; font-weight: 600;">Esta acci√≥n eliminar√° TODOS los archivos Excel y TODOS los c√≥digos de barras registrados. No se puede deshacer.</p>
            
            <button onclick="resetearSistema()" class="btn-danger" style="background-color: #dc2626; color: white; font-weight: 700;">
                üóëÔ∏è RESETEAR TODO EL SISTEMA
            </button>
        </div>
    </div>

    <!-- Modales -->
    <div id="modal-puesto" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nuevo Puesto</h3>
                <span class="modal-close" onclick="cerrarModal('modal-puesto')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="puesto-nombre">Nombre del Puesto:</label>
                    <input type="text" id="puesto-nombre" placeholder="Ej: Puesto A - L√≠nea 1">
                </div>
                <div class="input-group">
                    <label for="puesto-descripcion">Descripci√≥n:</label>
                    <textarea id="puesto-descripcion" placeholder="Descripci√≥n del puesto"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModal('modal-puesto')">Cancelar</button>
                <button class="btn-primary" onclick="guardarPuesto()">Guardar</button>
            </div>
        </div>
    </div>

    <div id="modal-maquina" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva M√°quina</h3>
                <span class="modal-close" onclick="cerrarModal('modal-maquina')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="maquina-puesto">Puesto:</label>
                    <select id="maquina-puesto" required>
                        <option value="">-- Seleccionar puesto --</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="maquina-nombre">Nombre de la M√°quina:</label>
                    <input type="text" id="maquina-nombre" placeholder="Ej: M√°quina Engastado 1">
                </div>
                <div class="input-group">
                    <label for="maquina-modelo">Modelo:</label>
                    <input type="text" id="maquina-modelo" placeholder="Ej: KOMAX Alpha 355">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="cerrarModal('modal-maquina')">Cancelar</button>
                <button class="btn-primary" onclick="guardarMaquina()">Guardar</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>
